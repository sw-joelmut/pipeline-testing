stages:
- stage: A
  dependsOn: []
  jobs:
    - job: A
      steps:
        - powershell: |
            Start-Sleep -s 5
            Write-Host "##vso[task.setvariable variable=queue;isOutput=true]1"
          displayName: Pre Deploy
        - powershell: |
            Write-Host "Deploy"
          displayName: Deploy

- stage: B
  dependsOn: []
  jobs:
    - job: 
      variables:
        queue: $[stageDependencies.A.A.outputs['Set_Variables.queue']]
      steps:
        - powershell: |
            while($true) { 
              "Checking"
              Start-Sleep -s 1
              write-host "$(queue)"
              if("$(queue)" -eq 0){
                Break
              }
            }
            Write-Host "test"
          displayName: Pre Deploy
        - powershell: |
            Write-Host "Deploy"
          displayName: Deploy

variables:
  counter: 0